@using Bookstore.Models.Dtos
@{
    ViewData["Title"] = "B·∫£ng ƒëi·ªÅu khi·ªÉn";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
    var stats = ViewBag.Stats as DashboardStatsDto ?? new DashboardStatsDto();
    var lowStockProducts = ViewBag.LowStockProducts as List<LowStockProductDto> ?? new List<LowStockProductDto>();
    var topSellingProducts = ViewBag.TopSellingProducts as List<TopSellingProductDto> ?? new List<TopSellingProductDto>();
}

<!-- Welcome Section -->
<div class="welcome-banner mb-4">
    <div class="row align-items-center">
        <div class="col-md-8">
            <h2 class="mb-1">Ch√†o m·ª´ng tr·ªü l·∫°i! üëã</h2>
            <p class="mb-0 opacity-75">ƒê√¢y l√† t·ªïng quan ho·∫°t ƒë·ªông c·ª≠a h√†ng c·ªßa b·∫°n h√¥m nay.</p>
        </div>
        <div class="col-md-4 text-md-end">
            <a href="@Url.Action("Index", "Reports")" class="btn btn-light">
                <i class="bi bi-bar-chart-line me-2"></i>Xem b√°o c√°o chi ti·∫øt
            </a>
        </div>
    </div>
</div>

<!-- Stats Cards Row 1 -->
<div class="row g-4 mb-4">
    <div class="col-xl-3 col-md-6">
        <div class="stat-card stat-card-primary">
            <div class="stat-card-body">
                <div class="stat-icon">
                    <i class="bi bi-book"></i>
                </div>
                <div class="stat-info">
                    <span class="stat-label">T·ªïng s·∫£n ph·∫©m</span>
                    <h3 class="stat-value">@stats.TotalProducts</h3>
                </div>
            </div>
            <div class="stat-card-footer">
                <a asp-controller="Products" asp-action="Index">Xem chi ti·∫øt <i class="bi bi-arrow-right"></i></a>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="stat-card stat-card-success">
            <div class="stat-card-body">
                <div class="stat-icon">
                    <i class="bi bi-currency-dollar"></i>
                </div>
                <div class="stat-info">
                    <span class="stat-label">Doanh thu th√°ng n√†y</span>
                    <h3 class="stat-value">@stats.MonthlyRevenue.ToString("N0")‚Ç´</h3>
                </div>
            </div>
            <div class="stat-card-footer">
                <a asp-controller="Reports" asp-action="Revenue">Xem b√°o c√°o <i class="bi bi-arrow-right"></i></a>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="stat-card stat-card-info">
            <div class="stat-card-body">
                <div class="stat-icon">
                    <i class="bi bi-cart-check"></i>
                </div>
                <div class="stat-info">
                    <span class="stat-label">T·ªïng ƒë∆°n h√†ng</span>
                    <h3 class="stat-value">@stats.TotalOrders</h3>
                </div>
            </div>
            <div class="stat-card-footer">
                <a asp-controller="Orders" asp-action="Index">Xem ƒë∆°n h√†ng <i class="bi bi-arrow-right"></i></a>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="stat-card stat-card-warning">
            <div class="stat-card-body">
                <div class="stat-icon">
                    <i class="bi bi-clock-history"></i>
                </div>
                <div class="stat-info">
                    <span class="stat-label">ƒê∆°n ch·ªù x·ª≠ l√Ω</span>
                    <h3 class="stat-value">@stats.PendingOrders</h3>
                </div>
            </div>
            <div class="stat-card-footer">
                <a asp-controller="Orders" asp-action="Index" asp-route-status="Pending">X·ª≠ l√Ω ngay <i class="bi bi-arrow-right"></i></a>
            </div>
        </div>
    </div>
</div>

<!-- Stats Cards Row 2 -->
<div class="row g-4 mb-4">
    <div class="col-xl-3 col-md-6">
        <div class="stat-card stat-card-purple">
            <div class="stat-card-body">
                <div class="stat-icon">
                    <i class="bi bi-people"></i>
                </div>
                <div class="stat-info">
                    <span class="stat-label">Ng∆∞·ªùi d√πng</span>
                    <h3 class="stat-value">@stats.TotalUsers</h3>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="stat-card stat-card-success">
            <div class="stat-card-body">
                <div class="stat-icon">
                    <i class="bi bi-cash-stack"></i>
                </div>
                <div class="stat-info">
                    <span class="stat-label">T·ªïng doanh thu</span>
                    <h3 class="stat-value">@stats.TotalRevenue.ToString("N0")‚Ç´</h3>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="stat-card stat-card-info">
            <div class="stat-card-body">
                <div class="stat-icon">
                    <i class="bi bi-tags"></i>
                </div>
                <div class="stat-info">
                    <span class="stat-label">Danh m·ª•c</span>
                    <h3 class="stat-value">@stats.TotalCategories</h3>
                </div>
            </div>
            <div class="stat-card-footer">
                <a asp-controller="Categories" asp-action="Index">Qu·∫£n l√Ω <i class="bi bi-arrow-right"></i></a>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="stat-card stat-card-danger">
            <div class="stat-card-body">
                <div class="stat-icon">
                    <i class="bi bi-exclamation-triangle"></i>
                </div>
                <div class="stat-info">
                    <span class="stat-label">S·∫£n ph·∫©m s·∫Øp h·∫øt</span>
                    <h3 class="stat-value">@stats.LowStockProducts</h3>
                </div>
            </div>
            <div class="stat-card-footer">
                <a asp-controller="Reports" asp-action="LowStock">Xem ngay <i class="bi bi-arrow-right"></i></a>
            </div>
        </div>
    </div>
</div>

<!-- Charts Row -->
<div class="row g-4 mb-4">
    <!-- Order Status Chart -->
    <div class="col-lg-4">
        <div class="admin-card h-100">
            <div class="admin-card-header">
                <h5 class="admin-card-title">
                    <i class="bi bi-pie-chart-fill text-primary me-2"></i>Tr·∫°ng th√°i ƒë∆°n h√†ng
                </h5>
            </div>
            <div class="admin-card-body">
                <div class="chart-container" style="height: 280px;">
                    <canvas id="orderStatusChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Revenue Trend Chart -->
    <div class="col-lg-8">
        <div class="admin-card h-100">
            <div class="admin-card-header">
                <h5 class="admin-card-title">
                    <i class="bi bi-graph-up-arrow text-success me-2"></i>Xu h∆∞·ªõng doanh thu (7 ng√†y g·∫ßn nh·∫•t)
                </h5>
            </div>
            <div class="admin-card-body">
                <div class="chart-container" style="height: 280px;">
                    <canvas id="revenueTrendChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mb-4">
    <!-- Top Selling Products -->
    <div class="col-lg-6">
        <div class="admin-card h-100">
            <div class="admin-card-header d-flex justify-content-between align-items-center">
                <h5 class="admin-card-title mb-0">
                    <i class="bi bi-star-fill text-warning me-2"></i>Top s·∫£n ph·∫©m b√°n ch·∫°y
                </h5>
                <a href="@Url.Action("TopProducts", "Reports")" class="btn btn-sm btn-outline-primary">
                    Xem t·∫•t c·∫£
                </a>
            </div>
            <div class="admin-card-body p-0">
                @if (topSellingProducts.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-hover admin-table mb-0">
                            <thead>
                                <tr>
                                    <th>S·∫£n ph·∫©m</th>
                                    <th class="text-center">ƒê√£ b√°n</th>
                                    <th class="text-end">Doanh thu</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var product in topSellingProducts)
                                {
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="product-avatar me-3">
                                                    <i class="bi bi-book"></i>
                                                </div>
                                                <div>
                                                    <strong class="d-block">@product.Title</strong>
                                                    <small class="text-muted">@product.CategoryName</small>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="text-center">
                                            <span class="badge bg-primary rounded-pill">@product.TotalSold</span>
                                        </td>
                                        <td class="text-end fw-bold text-success">@product.TotalRevenue.ToString("N0")‚Ç´</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <div class="text-center py-5">
                        <i class="bi bi-inbox text-muted" style="font-size: 3rem;"></i>
                        <p class="text-muted mt-3 mb-0">Ch∆∞a c√≥ d·ªØ li·ªáu b√°n h√†ng</p>
                    </div>
                }
            </div>
        </div>
    </div>

    <!-- Low Stock Alert -->
    <div class="col-lg-6">
        <div class="admin-card h-100">
            <div class="admin-card-header d-flex justify-content-between align-items-center">
                <h5 class="admin-card-title mb-0">
                    <i class="bi bi-exclamation-triangle-fill text-danger me-2"></i>C·∫£nh b√°o s·∫Øp h·∫øt h√†ng
                </h5>
                <a href="@Url.Action("LowStock", "Reports")" class="btn btn-sm btn-outline-danger">
                    Xem t·∫•t c·∫£
                </a>
            </div>
            <div class="admin-card-body p-0">
                @if (lowStockProducts.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-hover admin-table mb-0">
                            <thead>
                                <tr>
                                    <th>S·∫£n ph·∫©m</th>
                                    <th class="text-center">T·ªìn kho</th>
                                    <th class="text-end">Gi√° b√°n</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var product in lowStockProducts.Take(5))
                                {
                                    var stockClass = product.Stock <= 5 ? "bg-danger" : "bg-warning text-dark";
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="product-avatar product-avatar-warning me-3">
                                                    <i class="bi bi-exclamation"></i>
                                                </div>
                                                <div>
                                                    <strong class="d-block">@product.Title</strong>
                                                    <small class="text-muted">@product.CategoryName</small>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="text-center">
                                            <span class="badge @stockClass rounded-pill">@product.Stock c√≤n</span>
                                        </td>
                                        <td class="text-end">@product.Price.ToString("N0")‚Ç´</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <div class="text-center py-5">
                        <i class="bi bi-check-circle text-success" style="font-size: 3rem;"></i>
                        <p class="text-success mt-3 mb-0">T·∫•t c·∫£ s·∫£n ph·∫©m ƒë·ªÅu ƒë·ªß h√†ng!</p>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<div class="row g-4">
    <!-- Order Statistics -->
    <div class="col-lg-6">
        <div class="admin-card">
            <div class="admin-card-header">
                <h5 class="admin-card-title">
                    <i class="bi bi-clipboard-data text-info me-2"></i>Th·ªëng k√™ ƒë∆°n h√†ng
                </h5>
            </div>
            <div class="admin-card-body">
                <div class="order-stat-list">
                    <div class="order-stat-item">
                        <div class="order-stat-label">
                            <span class="order-stat-dot bg-secondary"></span>
                            T·ªïng ƒë∆°n h√†ng
                        </div>
                        <span class="order-stat-value">@stats.TotalOrders</span>
                    </div>
                    <div class="order-stat-item">
                        <div class="order-stat-label">
                            <span class="order-stat-dot bg-warning"></span>
                            Ch·ªù x·ª≠ l√Ω
                        </div>
                        <span class="order-stat-value text-warning">@stats.PendingOrders</span>
                    </div>
                    <div class="order-stat-item">
                        <div class="order-stat-label">
                            <span class="order-stat-dot bg-info"></span>
                            ƒêang x·ª≠ l√Ω
                        </div>
                        <span class="order-stat-value text-info">@stats.ProcessingOrders</span>
                    </div>
                    <div class="order-stat-item">
                        <div class="order-stat-label">
                            <span class="order-stat-dot bg-success"></span>
                            ƒê√£ ho√†n th√†nh
                        </div>
                        <span class="order-stat-value text-success">@stats.CompletedOrders</span>
                    </div>
                    <div class="order-stat-item">
                        <div class="order-stat-label">
                            <span class="order-stat-dot bg-danger"></span>
                            ƒê√£ h·ªßy
                        </div>
                        <span class="order-stat-value text-danger">@stats.CancelledOrders</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="col-lg-6">
        <div class="admin-card">
            <div class="admin-card-header">
                <h5 class="admin-card-title">
                    <i class="bi bi-lightning-fill text-warning me-2"></i>Thao t√°c nhanh
                </h5>
            </div>
            <div class="admin-card-body">
                <div class="row g-3">
                    <div class="col-6">
                        <a asp-controller="Products" asp-action="Create" class="quick-action-btn quick-action-primary">
                            <i class="bi bi-plus-circle"></i>
                            <span>Th√™m s·∫£n ph·∫©m</span>
                        </a>
                    </div>
                    <div class="col-6">
                        <a asp-controller="Categories" asp-action="Create" class="quick-action-btn quick-action-success">
                            <i class="bi bi-tag"></i>
                            <span>Th√™m danh m·ª•c</span>
                        </a>
                    </div>
                    <div class="col-6">
                        <a asp-controller="FlashSales" asp-action="Create" class="quick-action-btn quick-action-warning">
                            <i class="bi bi-lightning"></i>
                            <span>T·∫°o Flash Sale</span>
                        </a>
                    </div>
                    <div class="col-6">
                        <a asp-controller="Reports" asp-action="Index" class="quick-action-btn quick-action-info">
                            <i class="bi bi-bar-chart-line"></i>
                            <span>Xem b√°o c√°o</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
<style>
    .welcome-banner {
        background: linear-gradient(135deg, var(--admin-primary) 0%, var(--admin-primary-dark) 100%);
        color: white;
        padding: 1.5rem 2rem;
        border-radius: 12px;
    }
    
    .product-avatar {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, var(--admin-primary) 0%, #764ba2 100%);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
    }
    
    .product-avatar-warning {
        background: linear-gradient(135deg, #f6c23e 0%, #e74a3b 100%);
    }
    
    .order-stat-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    
    .order-stat-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 1rem;
        background: #f8f9fc;
        border-radius: 8px;
    }
    
    .order-stat-label {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-weight: 500;
    }
    
    .order-stat-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
    }
    
    .order-stat-value {
        font-size: 1.25rem;
        font-weight: 700;
    }
    
    .quick-action-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 1.5rem;
        border-radius: 12px;
        text-decoration: none;
        transition: all 0.3s ease;
        height: 100%;
    }
    
    .quick-action-btn i {
        font-size: 2rem;
        margin-bottom: 0.5rem;
    }
    
    .quick-action-btn span {
        font-weight: 600;
        font-size: 0.9rem;
    }
    
    .quick-action-primary {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        color: var(--admin-primary);
    }
    
    .quick-action-primary:hover {
        background: linear-gradient(135deg, var(--admin-primary) 0%, #764ba2 100%);
        color: white;
        transform: translateY(-3px);
    }
    
    .quick-action-success {
        background: rgba(28, 200, 138, 0.1);
        color: #1cc88a;
    }
    
    .quick-action-success:hover {
        background: linear-gradient(135deg, #1cc88a 0%, #17a673 100%);
        color: white;
        transform: translateY(-3px);
    }
    
    .quick-action-warning {
        background: rgba(246, 194, 62, 0.1);
        color: #f6c23e;
    }
    
    .quick-action-warning:hover {
        background: linear-gradient(135deg, #f6c23e 0%, #dda20a 100%);
        color: white;
        transform: translateY(-3px);
    }
    
    .quick-action-info {
        background: rgba(54, 185, 204, 0.1);
        color: #36b9cc;
    }
    
    .quick-action-info:hover {
        background: linear-gradient(135deg, #36b9cc 0%, #258391 100%);
        color: white;
        transform: translateY(-3px);
    }
</style>
}

@section Scripts {
<script>
    // Order Status Pie Chart
    const orderStatusCtx = document.getElementById('orderStatusChart').getContext('2d');
    new Chart(orderStatusCtx, {
        type: 'doughnut',
        data: {
            labels: ['Ch·ªù x·ª≠ l√Ω', 'ƒêang x·ª≠ l√Ω', 'Ho√†n th√†nh', 'ƒê√£ h·ªßy'],
            datasets: [{
                data: [@stats.PendingOrders, @stats.ProcessingOrders, @stats.CompletedOrders, @stats.CancelledOrders],
                backgroundColor: [
                    '#f6c23e',
                    '#36b9cc',
                    '#1cc88a',
                    '#e74a3b'
                ],
                borderWidth: 0,
                hoverOffset: 10
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '65%',
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 20,
                        usePointStyle: true,
                        pointStyle: 'circle'
                    }
                }
            }
        }
    });

    // Revenue Trend Line Chart (Mock data for 7 days)
    const revenueTrendCtx = document.getElementById('revenueTrendChart').getContext('2d');
    const today = new Date();
    const labels = [];
    for (let i = 6; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(date.getDate() - i);
        labels.push(date.toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit' }));
    }
    
    // Generate sample revenue data based on monthly revenue
    const avgDaily = @stats.MonthlyRevenue / 30;
    const sampleData = [];
    for (let i = 0; i < 7; i++) {
        sampleData.push(Math.round(avgDaily * (0.7 + Math.random() * 0.6)));
    }
    
    new Chart(revenueTrendCtx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Doanh thu (‚Ç´)',
                data: sampleData,
                borderColor: '#667eea',
                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: '#667eea',
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                pointRadius: 5,
                pointHoverRadius: 7
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    padding: 12,
                    titleFont: { size: 14 },
                    bodyFont: { size: 13 },
                    callbacks: {
                        label: function(context) {
                            return new Intl.NumberFormat('vi-VN').format(context.raw) + '‚Ç´';
                        }
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        display: false
                    }
                },
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(0, 0, 0, 0.05)'
                    },
                    ticks: {
                        callback: function(value) {
                            return new Intl.NumberFormat('vi-VN', { notation: 'compact' }).format(value) + '‚Ç´';
                        }
                    }
                }
            }
        }
    });
</script>
}
